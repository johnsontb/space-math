@font-face {
  font-family: "Atkinson";
  font-style: normal;
  font-weight: 400;
  src: local("Atkinson Hyperlegible");
}

:root {
  --bg: #0b1020;
  --bg2: #121a34;
  --card: #1b2352;
  --text: #e9eefc;
  --muted: #b7c2f3;
  --accent: #73ffd2;
  --accent-2: #ffd166;
  --danger: #ff6b6b;
  --success: #6bffb3;
  --button: #2a3a8a;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Atkinson, sans-serif;
  color: var(--text);
  background: radial-gradient(1200px 600px at 70% -10%, #233, transparent), var(--bg);
  overflow: hidden;
}

.app { display: grid; grid-template-rows: auto 1fr; height: 100%; }

.hud {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  align-items: center;
  padding: 10px 16px;
  background: linear-gradient(180deg, rgba(18,26,52,.95), rgba(18,26,52,.7));
  border-bottom: 1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(6px);
  position: relative; /* stacking context */
  z-index: 5; /* ensure above fixed video on Safari */
}
.hud-left, .hud-right { display: flex; align-items: center; gap: 10px; }
.hud-center { text-align: center; }
.logo { font-weight: 800; letter-spacing: .5px; }
.level-display { background: rgba(255,255,255,.06); padding: 6px 10px; border-radius: 8px; }
.stars { display: inline-flex; gap: 6px; align-items: center; justify-content: center; margin-bottom: 6px; }
.star { width: 20px; height: 20px; background: var(--accent-2); clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); opacity: .4; filter: drop-shadow(0 2px 0 rgba(0,0,0,.2)); }
.star.on { opacity: 1; transform: scale(1.1); }
.progress-stats { display: flex; gap: 14px; color: var(--muted); font-size: 14px; justify-content: center; }
.hud-button { background: var(--button); color: var(--text); border: none; border-radius: 10px; padding: 8px 12px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 0 #182a6e; }
.hud-button:active { transform: translateY(2px); box-shadow: 0 2px 0 #182a6e; }

.game { position: relative; display: grid; place-items: center; padding: 16px; }
.bg-canvas { position: fixed; inset: 0; z-index: 2; pointer-events: none; }

/* Background video layer */
.bg-video {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: -1; /* keep safely behind UI layers (Safari fix) */
  pointer-events: none;
  filter: brightness(0.6) saturate(1.1);
}

.character { position: absolute; top: calc(20% + var(--char-offset-y, 0px)); left: calc(10% + var(--char-offset-x, 0px)); width: clamp(100px, 14vw, 180px); height: auto; filter: drop-shadow(0 8px 12px rgba(0,0,0,.4)); animation: floaty 4s ease-in-out infinite; pointer-events: none; }
@keyframes floaty { 0%, 100% { transform: translateY(-6px) rotate(-4deg); } 50% { transform: translateY(4px) rotate(4deg); } }
.character.cheer { animation: cheer 700ms ease; }
@keyframes cheer { 0% { transform: scale(1) rotate(0deg); } 40% { transform: scale(1.3) rotate(-10deg); } 70% { transform: scale(1.2) rotate(10deg); } 100% { transform: scale(1) rotate(0deg); } }

.problem { position: relative; z-index: 2; background: linear-gradient(180deg, #1a2a60, #15245a); padding: 20px; border-radius: 18px; border: 1px solid rgba(255,255,255,.08); width: min(680px, 92vw); box-shadow: 0 12px 30px rgba(0,0,0,.35); }
.prompt { font-size: clamp(28px, 5vw, 48px); text-align: center; padding: 12px; border-radius: 12px; background: rgba(255,255,255,.06); margin-bottom: 16px; letter-spacing: .5px; }
.answers { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.answer-btn { font-size: clamp(22px, 4vw, 36px); padding: 18px; border-radius: 16px; border: none; cursor: pointer; color: #0a112a; background: linear-gradient(180deg, #9af, #6cf); box-shadow: 0 8px 0 #5280d9; transition: transform .05s; }
.answer-btn:active { transform: translateY(2px); box-shadow: 0 6px 0 #5280d9; }
.answer-btn.wrong { background: linear-gradient(180deg, #ffb3b3, #ff8a8a); box-shadow: 0 8px 0 #cc7373; }
.answer-btn.correct { background: linear-gradient(180deg, #a7ffcf, #6bffb3); box-shadow: 0 8px 0 #53cc90; }

/* Input-based answers */
.answer-input { font-size: clamp(22px, 4vw, 36px); padding: 18px; border-radius: 16px; border: 2px solid #6cf; background: rgba(255,255,255,.08); color: var(--text); outline: none; width: 100%; }
.answer-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(115,255,210,.25); }
.answer-input.wrong { border-color: var(--danger); }

.level-controls { position: absolute; right: 16px; bottom: 16px; display: flex; gap: 10px; z-index: 2; }
.nav-button { font-size: 22px; background: #2a3a8a; color: var(--text); border: none; border-radius: 12px; padding: 10px 14px; box-shadow: 0 6px 0 #182a6e; cursor: pointer; }
.nav-button:active { transform: translateY(2px); box-shadow: 0 4px 0 #182a6e; }

.level-map { position: absolute; inset: 10% 10% auto 10%; z-index: 5; background: #0f1738ee; border: 1px solid rgba(255,255,255,.1); border-radius: 16px; padding: 16px; box-shadow: 0 20px 60px rgba(0,0,0,.6); }
.level-map h2 { margin: 0 0 12px; }
.level-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
.level-card { background: linear-gradient(180deg, #223068, #1b2552); border: 1px solid rgba(255,255,255,.08); border-radius: 14px; padding: 10px; text-align: center; position: relative; }
.level-card.locked { opacity: .5; filter: grayscale(0.4); }
.level-card .big { font-size: 26px; margin-bottom: 6px; }
.level-card .stars-mini { display: flex; gap: 4px; justify-content: center; }
.level-card .star { width: 14px; height: 14px; }
.primary { background: linear-gradient(180deg, #6bf, #36c); color: #061034; border: none; border-radius: 12px; padding: 10px 14px; margin-top: 12px; cursor: pointer; box-shadow: 0 6px 0 #2b4e9e; }

.fx-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 9; }

/* Click poof */
.poof { position: absolute; width: 10px; height: 10px; border-radius: 50%; background: #fff8; pointer-events: none; animation: poof 500ms ease-out forwards; mix-blend-mode: screen; }
@keyframes poof { from { transform: scale(1); opacity: .9; } to { transform: scale(14); opacity: 0; } }

/* Responsive tweaks */
@media (max-width: 520px) {
  .hud { grid-template-columns: 1fr; gap: 6px; }
  .hud-right { justify-content: center; }
  .hud-left { justify-content: center; }
  .character { left: calc(6% + var(--char-offset-x, 0px)); width: clamp(90px, 22vw, 160px); }
  .answers { grid-template-columns: 1fr; }
}

/* === Retro-Tech (Star Wars console) Theme === */
.retro {
  /* Shift palette to greenish CRT vibe */
  --bg: #020a08;
  --bg2: #041411;
  --card: #061b1b;
  --text: #bfffe0;
  --muted: #7fe3b8;
  --accent: #6bffb3;
  --accent-2: #aaffcc;
  --button: #0c4030;
}

.retro body, .retro {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  letter-spacing: 0.4px;
}

/* Global CRT overlays */
body.retro::before {
  content: "";
  position: fixed; inset: 0;
  pointer-events: none;
  z-index: 1000;
  background: repeating-linear-gradient(
    to bottom,
    rgba(0, 0, 0, 0.22) 0px,
    rgba(0, 0, 0, 0.22) 1px,
    rgba(0, 0, 0, 0) 3px,
    rgba(0, 0, 0, 0) 4px
  );
  mix-blend-mode: multiply;
}
body.retro::after {
  content: "";
  position: fixed; inset: 0;
  pointer-events: none;
  z-index: 1001;
  background:
    radial-gradient(1000px 600px at 50% -10%, rgba(0,255,170,0.04), transparent 60%),
    radial-gradient(1200px 800px at 50% 110%, rgba(0,255,170,0.03), transparent 60%);
  animation: crt-flicker 6s ease-in-out infinite alternate;
}
@keyframes crt-flicker {
  0% { opacity: 0.35; filter: saturate(1) brightness(1); }
  100% { opacity: 0.55; filter: saturate(1.1) brightness(1.05); }
}

/* HUD bar: glassy green strip */
.retro .hud {
  background: linear-gradient(180deg, rgba(5,26,20,.85), rgba(5,26,20,.55));
  border-bottom: 1px solid rgba(111,255,183,.25);
  box-shadow: inset 0 -1px 0 rgba(0,0,0,.35), 0 8px 30px rgba(0,0,0,.4);
  backdrop-filter: blur(6px) saturate(1.1);
}
.retro .logo {
  text-transform: uppercase;
  letter-spacing: 1.4px;
  text-shadow: 0 0 8px rgba(107,255,179,.55);
}
.retro .level-display {
  background: rgba(107,255,179,.08);
  border: 1px solid rgba(107,255,179,.28);
  box-shadow: inset 0 0 12px rgba(107,255,179,.12);
}
.retro .progress-stats { color: #9af2cb; }

/* Panels */
.retro .problem {
  background: linear-gradient(180deg, rgba(4,32,26,.9), rgba(4,28,24,.85));
  border: 1px solid rgba(107,255,179,.28);
  box-shadow: 0 12px 30px rgba(0,0,0,.45), inset 0 0 20px rgba(107,255,179,.06);
  position: relative;
}
.retro .problem::before,
.retro .problem::after {
  content: "";
  position: absolute; inset: 8px;
  border: 1px dashed rgba(107,255,179,.22);
  pointer-events: none;
}
.retro .problem::after {
  inset: 14px 10px 10px 10px;
  border-style: solid;
  border-width: 0 0 1px 0;
  border-color: rgba(107,255,179,.18);
}
.retro .prompt {
  background: rgba(107,255,179,.06);
  border: 1px solid rgba(107,255,179,.28);
  text-shadow: 0 0 6px rgba(107,255,179,.35);
}

/* Buttons */
.retro .hud-button,
.retro .nav-button,
.retro .answer-btn,
.retro .primary {
  background: linear-gradient(180deg, rgba(5,40,32,.85), rgba(5,28,24,.85));
  color: #062416;
  border: 1px solid rgba(107,255,179,.45);
  box-shadow: 0 6px 0 rgba(3,26,20,.9), inset 0 0 20px rgba(107,255,179,.12);
}
.retro .hud-button,
.retro .nav-button,
.retro .primary {
  color: var(--text);
}
.retro .answer-btn { color: #061a12; background: linear-gradient(180deg, #68ffc9, #2cffae); box-shadow: 0 8px 0 #1a7f5e; }
.retro .answer-btn:active { transform: translateY(2px); box-shadow: 0 6px 0 #1a7f5e; }

/* Retro wrong-state: red alert + shake */
.retro .answer-btn.wrong {
  color: #260606;
  background: linear-gradient(180deg, #ff7a7a, #ff3b3b);
  border: 1px solid rgba(255,90,90,.7);
  box-shadow:
    0 8px 0 rgba(90,10,10,.9),
    0 0 14px rgba(255,70,70,.55),
    inset 0 0 12px rgba(255,230,230,.35);
  animation: sw-shake 450ms cubic-bezier(.36,.07,.19,.97);
}
.retro .answer-input.wrong {
  border-color: #ff5252;
  box-shadow: 0 0 0 3px rgba(255,82,82,.25), 0 0 18px rgba(255,70,70,.35);
  animation: sw-shake 450ms cubic-bezier(.36,.07,.19,.97);
}

/* Cockpit hit shake on the whole problem card */
.retro .problem.hit {
  animation: cockpit-shake 500ms cubic-bezier(.36,.07,.19,.97);
  border-color: rgba(255,110,110,.45);
  box-shadow: 0 12px 30px rgba(0,0,0,.55), inset 0 0 24px rgba(255,120,120,.12);
}

@keyframes sw-shake {
  0% { transform: translateX(0); }
  10% { transform: translateX(-6px) rotate(-0.5deg); }
  20% { transform: translateX(6px) rotate(0.4deg); }
  30% { transform: translateX(-5px) rotate(-0.4deg); }
  40% { transform: translateX(5px) rotate(0.3deg); }
  50% { transform: translateX(-4px); }
  60% { transform: translateX(4px); }
  70% { transform: translateX(-3px); }
  80% { transform: translateX(3px); }
  90% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

@keyframes cockpit-shake {
  0% { transform: translate(0,0); }
  15% { transform: translate(-6px, 2px) rotate(-0.6deg); }
  30% { transform: translate(5px, -3px) rotate(0.5deg); }
  45% { transform: translate(-4px, 2px) rotate(-0.4deg); }
  60% { transform: translate(3px, -2px) rotate(0.3deg); }
  75% { transform: translate(-2px, 1px); }
  100% { transform: translate(0,0); }
}

/* Level map cards */
.retro .level-map { background: #051a16ee; border-color: rgba(107,255,179,.25); }
.retro .level-card { background: linear-gradient(180deg, #08261f, #071f1a); border-color: rgba(107,255,179,.22); }
.retro .level-card.locked { filter: grayscale(0.2) opacity(0.7); }

/* Character subtle glow */
.retro .character { filter: drop-shadow(0 10px 14px rgba(0,0,0,.55)) drop-shadow(0 0 16px rgba(107,255,179,.15)); }

/* Background video tint for readability */
.retro .bg-video { filter: brightness(0.55) saturate(1.15) hue-rotate(-10deg); }

/* Grid overlay (light) underneath UI */
.retro .bg-canvas {
  background-image:
    linear-gradient(to right, rgba(107,255,179,.05) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(107,255,179,.05) 1px, transparent 1px);
  background-size: 60px 60px, 60px 60px;
  background-position: center;
}

/* Star-Wars-inspired mission panel */
.sw-panel { margin-top: 8px; display: grid; gap: 6px; justify-items: center; }
.sw-header { font-size: 12px; letter-spacing: 2px; opacity: .9; }
.trench-meter {
  position: relative;
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 3px;
  width: min(560px, 80vw);
  height: 16px;
  padding: 4px;
  border-radius: 10px;
  border: 1px solid rgba(255,90,60,.45);
  background: linear-gradient(180deg, rgba(40,8,8,.65), rgba(30,6,6,.5));
  box-shadow: inset 0 0 20px rgba(255,90,60,.18);
  overflow: hidden;
}
.trench-meter .seg {
  border: 1px solid rgba(255,120,90,.35);
  background: rgba(255,120,90,.14);
  box-shadow: inset 0 0 10px rgba(255,140,120,.12);
}
.trench-meter .seg.on {
  background: linear-gradient(180deg, #ff7a50, #ff5640);
  box-shadow: 0 0 10px rgba(255,110,90,.55), inset 0 0 10px rgba(255,220,210,.35);
}
.trench-meter .scanner {
  content: "";
  position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,200,180,.25) 40%, rgba(255,200,180,.25) 60%, transparent);
  transform: translateX(-100%);
  animation: scanner-sweep 3.8s linear infinite;
  pointer-events: none;
}
@keyframes scanner-sweep { to { transform: translateX(100%); } }

.sw-readouts { display: flex; gap: 16px; font-size: 12px; opacity: .9; }
.sw-readouts span { background: rgba(255,120,90,.08); border: 1px solid rgba(255,120,90,.3); padding: 2px 6px; border-radius: 6px; }
.sw-readouts b { color: #ffb6a1; font-weight: 700; text-shadow: 0 0 8px rgba(255,120,90,.4); }
